<!--
Copyright 2017 Intel Corporation.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <script type="text/javascript" src="script.js"></script>
        <script type="text/javascript" src="gl.js"></script>
        <script type="text/javascript" src="depth-camera.js"></script>
        <script type="text/javascript" src="third_party/gl-matrix.js"></script>
        <script id="vertexshader" type="x-shader/x-vertex">
            // All of the depth data.
            uniform sampler2D u_depth_texture;
            // Index of the depth_texture pixel that we are processing in this
            // instance of the shader. Calculated outside of the shader, because
            // OpenGL ES doesn't support gl_VertexId. Ranges from [0, 0] to
            // [u_depth_texture_size.x, u_depth_texture_size.y].
            attribute vec2 a_depth_texture_index;
            // Width and height of the depth data.
            uniform vec2 u_depth_texture_size;
            // Width and height of the color data.
            uniform vec2 u_color_texture_size;
            varying float v_depth;

            void main() {
                vec2 depth_texture_coord = a_depth_texture_index
                                         / u_depth_texture_size;
                float depth = texture2D(u_depth_texture,
                                        depth_texture_coord).r;
                v_depth = depth * 10.0;
                gl_Position = vec4(depth_texture_coord, 0, 1);
            }
        </script>
        <script id="fragmentshader" type="x-shader/x-fragment">
            precision mediump float;
            uniform sampler2D u_color_texture;
            varying float v_depth;

            void main() {
                gl_FragColor = vec4(0, v_depth, 0, 1);
            }
        </script>
    </head>
    <body style="background: black; color: #888888" onload="main()">
        <div id="errormessages" style="font-color: red">
            <!-- Print error messages here. -->
        </div>
        <canvas id="webglcanvas"
                style="position: relative; background-color: black;">
        </canvas>
        <!-- Dummy <video> elements, will be shown via WebGL, not here. -->
        <h4>Raw color data:</h4>
        <video id="colorStream" autoplay
            style="position: relative; width: 100px;
                   border: 1px solid grey">
        </video>
        <h4>Raw depth data:</h4>
        <video id="depthStream" autoplay
            style="position:relative; width: 100px;
                   border: 1px solid grey">
        </video>
    </body>
</html>
